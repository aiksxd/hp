<!DOCTYPE html>
<html>

<head>
    <title>Hardly Print Editor</title>
    <link rel="stylesheet" href="./css/workflow.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/titlebar.css">
    <script src="./js/x6.js"></script>
    <script src="./js/vs/loader.js"></script>
    <script type="module" src="./js/main.js"></script>
    <script type="module" src="./js/workflow.js"></script>
</head>

<body style="background-color: transparent">
    <div class="titlebar" data-tauri-drag-region>
        Hardly Print Editor
        <div class="controls">
            <button id="titlebar-minimize">-</button>
            <button id="titlebar-maximize">f</button>
            <button id="titlebar-close">x</button>
        </div>
    </div>
    <div style="width:100%; height:100%">
        <div id="workflow-container"></div>
    </div>
    <div id="editor-container">
        <nav class="navs"></nav>
    </div>
    <div class="node-toolbar" style="position: absolute; top: 30px; left: 10px; z-index: 1000;">
        <button onclick="addNewRustNode()" style="background: #3a5f8f; color: white; border: 1px solid #8FBCBB; padding: 8px 12px; border-radius: 4px; cursor: pointer;">
            + Node
        </button>
    </div>
    <script>
        // monaco editor
        require.config({ paths: { 'vs': '/js/vs' } });
        require(['vs/editor/editor.main'], function () {

            // 初始化变量
            var fileCounter = 0;
            var editorArray = [];
            var defaultCode = [
                'fn main() {',
                '    print!("Hello Mr. Gao").unwrap();',
                '}',
            ].join('\n');

            monaco.editor.defineTheme("myTheme", {
                base: "vs-dark",
                inherit: true,
                rules: [],
                colors: {
                    // "editor.foreground": "#000000",
                    "editor.background": "#282C33",
                    // "editorCursor.foreground": "#8B0000",
                    "editor.lineHighlightBackground": "#2D323B",
                    // "editorLineNumber.foreground": "#008800",
                    // "editor.selectionBackground": "#88000030",
                    // "editor.inactiveSelectionBackground": "#88000015",
                },
            });
            monaco.editor.setTheme("myTheme");

            // 新建一个编辑器
            function newEditor(container_id, code, language) {
                var model = monaco.editor.createModel(code, language);
                var editor = monaco.editor.create(document.getElementById(container_id), {
                    model: model,
                    fontFamily: "JetBrains Mono",
                    fontSize: 20,
                });
                editorArray.push(editor);
                return editor;
            }

            function addNewEditor(code, language) {
                var new_container = document.createElement("div");
                new_container.id = "editor-" + fileCounter.toString(10);
                new_container.className = "editor";
                document.getElementById("editor-container").appendChild(new_container);
                newEditor(new_container.id, code, language);
                fileCounter += 1;
            }

            addNewEditor(defaultCode, 'rust');

        });
        const editor_container = document.getElementById('editor-container');

        // 点击编辑器时展开
        editor_container.addEventListener('click', function(e) {
            e.stopPropagation();
            this.classList.add('active');
        });

        // 点击页面其他区域时收起
        document.addEventListener('click', function(e) {
            if (!editor_container.contains(e.target)) {
                editor_container.classList.remove('active');
            }
        });

        // 可选：防止编辑器内容内的点击事件误触发收起
        editor_container.addEventListener('click', function(e) {
            e.stopPropagation();
        });

        // 添加新节点的函数
        function addNewRustNode() {
            const x = 100 + Math.random() * 300
            const y = 100 + Math.random() * 300
            
            window.createRustNode({
                x: x,
                y: y,
                data: {
                    label: 'New Node',
                    state: 'Ready'
                }
            })
        }
    </script>
</body>

</html>