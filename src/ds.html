<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VS Code风格编辑器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e1e1e;
            color: #cccccc;
            overflow: hidden;
            height: 100vh;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        /* 侧边栏样式 */
        .sidebar {
            width: 250px;
            background-color: #333333;
            border-right: 1px solid #464647;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 10px;
            border-bottom: 1px solid #464647;
            font-size: 14px;
            font-weight: bold;
        }
        
        .file-explorer {
            flex: 1;
            overflow-y: auto;
        }
        
        .file-item {
            padding: 5px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .file-item:hover {
            background-color: #2a2d2e;
        }
        
        .file-item.active {
            background-color: #37373d;
        }
        
        .file-icon {
            margin-right: 8px;
            width: 16px;
            height: 16px;
        }
        
        /* 主编辑区域样式 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .tab-container {
            background-color: #2d2d2d;
            border-bottom: 1px solid #464647;
            display: flex;
            overflow-x: auto;
        }
        
        .tab {
            padding: 8px 15px;
            background-color: #2d2d2d;
            border-right: 1px solid #464647;
            cursor: pointer;
            display: flex;
            align-items: center;
            min-width: 150px;
        }
        
        .tab.active {
            background-color: #1e1e1e;
        }
        
        .tab-close {
            margin-left: auto;
            opacity: 0.7;
        }
        
        .tab-close:hover {
            opacity: 1;
        }
        
        .editor-container {
            flex: 1;
            overflow: hidden;
        }
        
        #editor {
            width: 100%;
            height: 100%;
        }
        
        /* 状态栏样式 */
        .status-bar {
            background-color: #007acc;
            height: 22px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            font-size: 12px;
            justify-content: space-between;
        }
        
        .status-left, .status-right {
            display: flex;
            align-items: center;
        }
        
        .status-item {
            margin-right: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                资源管理器
            </div>
            <div class="file-explorer">
                <div class="file-item active" data-file="index.html">
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0iI2NjY2NjYyI+PHBhdGggZD0iTTEwLjUgMUgydjE0aDE0VjMuNUwxMC41IDF6bS4yIDJMMTMgNS44SDExVjN6TTMgMTNWM2g3djNoNHY3SDN6Ii8+PC9zdmc+" class="file-icon">
                    index.html
                </div>
                <div class="file-item" data-file="script.js">
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0iI2NjY2NjYyI+PHBhdGggZD0iTTEwLjUgMUgydjE0aDE0VjMuNUwxMC41IDF6bS4yIDJMMTMgNS44SDExVjN6TTMgMTNWM2g3djNoNHY3SDN6Ii8+PC9zdmc+" class="file-icon">
                    script.js
                </div>
                <div class="file-item" data-file="styles.css">
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0iI2NjY2NjYyI+PHBhdGggZD0iTTEwLjUgMUgydjE0aDE0VjMuNUwxMC41IDF6bS4yIDJMMTMgNS44SDExVjN6TTMgMTNWM2g3djNoNHY3SDN6Ii8+PC9zdmc+" class="file-icon">
                    styles.css
                </div>
                <div class="file-item" data-file="main.rs">
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0iI2NjY2NjYyI+PHBhdGggZD0iTTEwLjUgMUgydjE0aDE0VjMuNUwxMC41IDF6bS4yIDJMMTMgNS44SDExVjN6TTMgMTNWM2g3djNoNHY3SDN6Ii8+PC9zdmc+" class="file-icon">
                    main.rs
                </div>
            </div>
        </div>
        
        <!-- 主编辑区域 -->
        <div class="main-content">
            <!-- 标签页 -->
            <div class="tab-container">
                <div class="tab active" data-file="index.html">
                    index.html
                    <span class="tab-close">×</span>
                </div>
            </div>
            
            <!-- 编辑器 -->
            <div class="editor-container">
                <div id="editor"></div>
            </div>
            
            <!-- 状态栏 -->
            <div class="status-bar">
                <div class="status-left">
                    <span class="status-item">Ln 1, Col 1</span>
                    <span class="status-item">Spaces: 4</span>
                    <span class="status-item">UTF-8</span>
                </div>
                <div class="status-right">
                    <span class="status-item">HTML</span>
                </div>
            </div>
        </div>
    </div>
    <script src="../node_modules/monaco-editor/min/vs/loader.js"></script>
    <!-- 引入Monaco Editor -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.min.js"></script> -->
    
    <script>
        // 文件内容定义
        const fileContents = {
            'index.html': `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的网页</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>欢迎来到我的网站</h1>
    <p>这是一个示例段落。</p>
    <script src="script.js"><\/script>
</body>
</html>`,
                        'script.js': `// 示例JavaScript代码
function greet(name) {
    return 'Hello, ' + name + '!';
}

console.log(greet('World'));

// 与Tauri交互的示例函数
async function saveFile(content) {
    // 这里需要实现与Tauri的交互
    // 例如: await invoke('save_file', { content });
    console.log('保存文件:', content);
}

// 调用示例
saveFile('文件内容');`,
            'styles.css': `/* 示例CSS代码 */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f0f0f0;
}

h1 {
    color: #333;
    text-align: center;
}

p {
    color: #666;
    line-height: 1.6;
}`,
                        'main.rs': `// 示例Rust代码
fn main() {
    println!("Hello, world!");
    
    let x = 5;
    let y = 10;
    let sum = add(x, y);
    
    println!("{} + {} = {}", x, y, sum);
}

fn add(a: i32, b: i32) -> i32 {
    a + b
}`
        };

        // 初始化Monaco Editor
        // require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs' } });
        require.config({ paths: { 'vs': '../node_modules/monaco-editor/min/vs' } });
        
        require(['vs/editor/editor.main'], function() {
            // 创建编辑器
            const editor = monaco.editor.create(document.getElementById('editor'), {
                value: fileContents['index.html'],
                language: 'html',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: {
                    enabled: true
                }
            });
            
            // 当前打开的文件
            let currentFile = 'index.html';
            
            // 文件切换功能
            document.querySelectorAll('.file-item').forEach(item => {
                item.addEventListener('click', function() {
                    const fileName = this.getAttribute('data-file');
                    
                    // 更新活动文件
                    document.querySelectorAll('.file-item').forEach(f => f.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 如果文件已经在标签页中打开，直接激活该标签页
                    const existingTab = document.querySelector(`.tab[data-file="${fileName}"]`);
                    if (existingTab) {
                        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                        existingTab.classList.add('active');
                        
                        // 更新编辑器内容
                        editor.setValue(fileContents[fileName]);
                        
                        // 更新语言模式
                        updateEditorLanguage(fileName);
                        
                        currentFile = fileName;
                        return;
                    }
                    
                    // 创建新标签页
                    const tabContainer = document.querySelector('.tab-container');
                    const newTab = document.createElement('div');
                    newTab.className = 'tab active';
                    newTab.setAttribute('data-file', fileName);
                    newTab.innerHTML = `
                        ${fileName}
                        <span class="tab-close">×</span>
                    `;
                    
                    // 移除其他标签页的active状态
                    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                    
                    // 添加新标签页
                    tabContainer.appendChild(newTab);
                    
                    // 更新编辑器内容
                    editor.setValue(fileContents[fileName]);
                    
                    // 更新语言模式
                    updateEditorLanguage(fileName);
                    
                    currentFile = fileName;
                    
                    // 添加标签页关闭事件
                    newTab.querySelector('.tab-close').addEventListener('click', function(e) {
                        e.stopPropagation();
                        closeTab(fileName);
                    });
                    
                    // 添加标签页点击事件
                    newTab.addEventListener('click', function() {
                        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                        this.classList.add('active');
                        
                        // 更新编辑器内容
                        editor.setValue(fileContents[fileName]);
                        
                        // 更新语言模式
                        updateEditorLanguage(fileName);
                        
                        currentFile = fileName;
                    });
                });
            });
            
            // 更新编辑器语言模式
            function updateEditorLanguage(fileName) {
                const extension = fileName.split('.').pop();
                let language = 'plaintext';
                
                switch(extension) {
                    case 'html':
                        language = 'html';
                        break;
                    case 'js':
                        language = 'javascript';
                        break;
                    case 'css':
                        language = 'css';
                        break;
                    case 'rs':
                        language = 'rust';
                        break;
                }
                
                const model = editor.getModel();
                monaco.editor.setModelLanguage(model, language);
                
                // 更新状态栏中的语言指示器
                document.querySelector('.status-right .status-item').textContent = language.toUpperCase();
            }
            
            // 关闭标签页
            function closeTab(fileName) {
                const tabToClose = document.querySelector(`.tab[data-file="${fileName}"]`);
                
                if (tabToClose) {
                    // 如果是当前活动标签页，需要激活另一个标签页
                    if (tabToClose.classList.contains('active')) {
                        const tabs = document.querySelectorAll('.tab');
                        if (tabs.length > 1) {
                            let newActiveTab = null;
                            
                            // 找到下一个标签页
                            for (let i = 0; i < tabs.length; i++) {
                                if (tabs[i] === tabToClose) {
                                    if (i > 0) {
                                        newActiveTab = tabs[i - 1];
                                    } else if (i < tabs.length - 1) {
                                        newActiveTab = tabs[i + 1];
                                    }
                                    break;
                                }
                            }
                            
                            if (newActiveTab) {
                                newActiveTab.classList.add('active');
                                const newFileName = newActiveTab.getAttribute('data-file');
                                editor.setValue(fileContents[newFileName]);
                                updateEditorLanguage(newFileName);
                                currentFile = newFileName;
                            }
                        }
                    }
                    
                    // 移除标签页
                    tabToClose.remove();
                }
            }
            
            // 监听编辑器内容变化
            editor.onDidChangeModelContent(function() {
                // 保存当前文件内容到内存
                fileContents[currentFile] = editor.getValue();
                
                // 这里可以添加自动保存功能
                // 例如: autoSaveFile();
            });
            
            // 与Tauri交互的函数 - 这些需要您来实现
            async function saveFile() {
                // 保存当前文件
                // 这里需要实现与Tauri的交互
                console.log('保存文件:', currentFile);
            }
            
            async function openFile() {
                // 打开文件对话框
                // 这里需要实现与Tauri的交互
                console.log('打开文件');
            }
            
            async function newFile() {
                // 创建新文件
                // 这里需要实现与Tauri的交互
                console.log('新建文件');
            }
            
            // 暴露这些函数给全局作用域，以便您实现Tauri交互
            window.saveFile = saveFile;
            window.openFile = openFile;
            window.newFile = newFile;
        });
    </script>
</body>
</html>